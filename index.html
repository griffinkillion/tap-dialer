<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tap-to-Call Dialer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f7;
            min-height: 100vh;
        }
        h1 {
            font-size: 24px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 20px;
        }
        .upload-area {
            background: white;
            border: 2px dashed #d2d2d7;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 20px;
        }
        .upload-area:hover {
            border-color: #007aff;
            background: #f0f7ff;
        }
        .upload-area.dragover {
            border-color: #007aff;
            background: #e5f1ff;
        }
        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        .upload-text {
            color: #86868b;
            font-size: 16px;
        }
        input[type="file"] {
            display: none;
        }
        .column-selector {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            display: none;
        }
        .column-selector label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #1d1d1f;
        }
        .column-selector select {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            background: white;
            margin-bottom: 12px;
        }
        .stats {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            display: none;
        }
        .stats-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .stats-row:last-child {
            border-bottom: none;
        }
        .stats-label {
            color: #86868b;
        }
        .stats-value {
            font-weight: 600;
            color: #1d1d1f;
        }
        .contact-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .contact-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .contact-card.called {
            background: #f0fff0;
            opacity: 0.7;
        }
        .contact-info {
            flex: 1;
            min-width: 0;
        }
        .contact-name {
            font-weight: 600;
            color: #1d1d1f;
            font-size: 17px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .contact-number {
            color: #86868b;
            font-size: 15px;
            margin-top: 2px;
        }
        .call-btn {
            background: #34c759;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            flex-shrink: 0;
            margin-left: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: transform 0.1s;
        }
        .call-btn:active {
            transform: scale(0.95);
        }
        .called .call-btn {
            background: #86868b;
        }
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #86868b;
        }
        .reset-btn {
            width: 100%;
            padding: 16px;
            background: #ff3b30;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            margin-bottom: 80px;
            display: none;
        }
        .search-fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            background: #007aff;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,122,255,0.4);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: transform 0.2s;
        }
        .search-fab:active {
            transform: scale(0.95);
        }
        .search-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            display: none;
            align-items: flex-start;
            justify-content: center;
            padding-top: 60px;
        }
        .search-overlay.active {
            display: flex;
        }
        .search-box {
            background: white;
            border-radius: 12px;
            padding: 12px 16px;
            width: calc(100% - 40px);
            max-width: 460px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .search-box input {
            flex: 1;
            border: none;
            font-size: 17px;
            outline: none;
            padding: 8px 0;
        }
        .search-box .clear-btn {
            background: #e5e5ea;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            color: #8e8e93;
            display: none;
        }
        .search-box .clear-btn.visible {
            display: block;
        }
        .no-results {
            text-align: center;
            padding: 40px;
            color: #86868b;
        }
        .outcome-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 300;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .outcome-modal.active {
            display: flex;
        }
        .outcome-box {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 320px;
            overflow: hidden;
        }
        .outcome-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #e5e5ea;
        }
        .outcome-header h3 {
            margin: 0 0 4px 0;
            font-size: 18px;
            color: #1d1d1f;
        }
        .outcome-header p {
            margin: 0;
            font-size: 14px;
            color: #86868b;
        }
        .outcome-buttons {
            display: flex;
            flex-direction: column;
        }
        .outcome-btn {
            padding: 16px;
            border: none;
            background: white;
            font-size: 17px;
            cursor: pointer;
            border-bottom: 1px solid #e5e5ea;
            transition: background 0.15s;
        }
        .outcome-btn:last-child {
            border-bottom: none;
        }
        .outcome-btn:active {
            background: #f0f0f0;
        }
        .outcome-btn.no-answer {
            color: #8e8e93;
        }
        .outcome-btn.call-back {
            color: #ff9500;
        }
        .outcome-btn.qualified {
            color: #34c759;
        }
        .outcome-btn.unqualified {
            color: #ff3b30;
        }
        .outcome-badge {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 10px;
            margin-left: 8px;
            font-weight: 600;
        }
        .badge-no-answer {
            background: #e5e5ea;
            color: #8e8e93;
        }
        .badge-call-back {
            background: #fff3e0;
            color: #ff9500;
        }
        .badge-qualified {
            background: #e8f5e9;
            color: #34c759;
        }
        .badge-unqualified {
            background: #ffebee;
            color: #ff3b30;
        }
    </style>
</head>
<body>
    <h1>üìû Tap-to-Call Dialer</h1>

```
<div class="upload-area" id="uploadArea">
    <div class="upload-icon">üìÅ</div>
    <div class="upload-text">Tap to upload Excel or CSV file</div>
    <input type="file" id="fileInput" accept=".xlsx,.xls,.csv">
</div>

<div class="column-selector" id="columnSelector">
    <label for="nameColumn">Name Column (optional)</label>
    <select id="nameColumn">
        <option value="">-- None --</option>
    </select>
    
    <label for="phoneColumn">Phone Number Column</label>
    <select id="phoneColumn"></select>
</div>

<div class="stats" id="stats">
    <div class="stats-row">
        <span class="stats-label">Total contacts</span>
        <span class="stats-value" id="totalCount">0</span>
    </div>
    <div class="stats-row">
        <span class="stats-label">Called</span>
        <span class="stats-value" id="calledCount">0</span>
    </div>
    <div class="stats-row">
        <span class="stats-label">Remaining</span>
        <span class="stats-value" id="remainingCount">0</span>
    </div>
</div>

<div class="contact-list" id="contactList"></div>

<button class="reset-btn" id="resetBtn">Reset All</button>

<button class="search-fab" id="searchFab">üîç</button>

<div class="search-overlay" id="searchOverlay">
    <div class="search-box">
        <span>üîç</span>
        <input type="text" id="searchInput" placeholder="Search contacts..." autocomplete="off">
        <button class="clear-btn" id="clearSearch">‚úï</button>
    </div>
</div>

<div class="outcome-modal" id="outcomeModal">
    <div class="outcome-box">
        <div class="outcome-header">
            <h3>Call Outcome</h3>
            <p id="outcomeContactName">Contact Name</p>
        </div>
        <div class="outcome-buttons">
            <button class="outcome-btn no-answer" data-outcome="no-answer">No Answer</button>
            <button class="outcome-btn call-back" data-outcome="call-back">Call Back</button>
            <button class="outcome-btn qualified" data-outcome="qualified">Qualified</button>
            <button class="outcome-btn unqualified" data-outcome="unqualified">Unqualified</button>
        </div>
    </div>
</div>

<script>
    let contacts = [];
    let calledSet = new Set();
    let rawData = [];
    let headers = [];

    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const columnSelector = document.getElementById('columnSelector');
    const nameColumn = document.getElementById('nameColumn');
    const phoneColumn = document.getElementById('phoneColumn');
    const contactList = document.getElementById('contactList');
    const stats = document.getElementById('stats');
    const resetBtn = document.getElementById('resetBtn');
    const searchFab = document.getElementById('searchFab');
    const searchOverlay = document.getElementById('searchOverlay');
    const searchInput = document.getElementById('searchInput');
    const clearSearch = document.getElementById('clearSearch');
    const outcomeModal = document.getElementById('outcomeModal');
    const outcomeContactName = document.getElementById('outcomeContactName');
    let searchTerm = '';
    let currentCallId = null;
    let outcomes = {};

    // Upload area interactions
    uploadArea.addEventListener('click', () => fileInput.click());
    
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        if (e.dataTransfer.files.length) {
            handleFile(e.dataTransfer.files[0]);
        }
    });

    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length) {
            handleFile(e.target.files[0]);
        }
    });

    function handleFile(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const sheetName = workbook.SheetNames[0];
            const sheet = workbook.Sheets[sheetName];
            rawData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
            
            if (rawData.length > 0) {
                headers = rawData[0].map((h, i) => h || `Column ${i + 1}`);
                populateColumnSelectors();
                columnSelector.style.display = 'block';
            }
        };
        reader.readAsArrayBuffer(file);
    }

    function populateColumnSelectors() {
        nameColumn.innerHTML = '<option value="">-- None --</option>';
        phoneColumn.innerHTML = '';
        
        headers.forEach((header, index) => {
            const nameOpt = document.createElement('option');
            nameOpt.value = index;
            nameOpt.textContent = header;
            nameColumn.appendChild(nameOpt);
            
            const phoneOpt = document.createElement('option');
            phoneOpt.value = index;
            phoneOpt.textContent = header;
            phoneColumn.appendChild(phoneOpt);
        });

        // Auto-select likely phone column
        const phoneKeywords = ['phone', 'tel', 'mobile', 'cell', 'number', 'dial'];
        const nameKeywords = ['name', 'contact', 'person', 'customer', 'client'];
        
        headers.forEach((header, index) => {
            const lowerHeader = header.toString().toLowerCase();
            if (phoneKeywords.some(k => lowerHeader.includes(k))) {
                phoneColumn.value = index;
            }
            if (nameKeywords.some(k => lowerHeader.includes(k))) {
                nameColumn.value = index;
            }
        });

        nameColumn.addEventListener('change', loadContacts);
        phoneColumn.addEventListener('change', loadContacts);
        
        loadContacts();
    }

    function loadContacts() {
        const phoneIdx = parseInt(phoneColumn.value);
        const nameIdx = nameColumn.value ? parseInt(nameColumn.value) : null;
        
        contacts = [];
        
        for (let i = 1; i < rawData.length; i++) {
            const row = rawData[i];
            let phone = row[phoneIdx];
            
            if (phone) {
                phone = String(phone).replace(/[^\d+]/g, '');
                if (phone.length >= 7) {
                    contacts.push({
                        id: i,
                        name: nameIdx !== null ? (row[nameIdx] || `Contact ${i}`) : `Contact ${i}`,
                        phone: phone,
                        displayPhone: formatPhone(phone)
                    });
                }
            }
        }
        
        renderContacts();
    }

    function formatPhone(phone) {
        if (phone.length === 10) {
            return `(${phone.slice(0,3)}) ${phone.slice(3,6)}-${phone.slice(6)}`;
        } else if (phone.length === 11 && phone[0] === '1') {
            return `+1 (${phone.slice(1,4)}) ${phone.slice(4,7)}-${phone.slice(7)}`;
        }
        return phone;
    }

    function renderContacts() {
        if (contacts.length === 0) {
            contactList.innerHTML = '<div class="empty-state">No phone numbers found</div>';
            stats.style.display = 'none';
            resetBtn.style.display = 'none';
            searchFab.style.display = 'none';
            return;
        }

        stats.style.display = 'block';
        resetBtn.style.display = 'block';
        searchFab.style.display = 'flex';
        updateStats();

        const filtered = contacts.filter(contact => {
            if (!searchTerm) return true;
            const term = searchTerm.toLowerCase();
            return contact.name.toLowerCase().includes(term) || 
                   contact.phone.includes(term) ||
                   contact.displayPhone.includes(term);
        });

        if (filtered.length === 0) {
            contactList.innerHTML = '<div class="no-results">No contacts match your search</div>';
            return;
        }

        contactList.innerHTML = filtered.map(contact => {
            const outcome = outcomes[contact.id];
            const badgeHtml = outcome ? `<span class="outcome-badge badge-${outcome}">${formatOutcome(outcome)}</span>` : '';
            return `
            <div class="contact-card ${calledSet.has(contact.id) ? 'called' : ''}" data-id="${contact.id}">
                <div class="contact-info">
                    <div class="contact-name">${escapeHtml(contact.name)}${badgeHtml}</div>
                    <div class="contact-number">${contact.displayPhone}</div>
                </div>
                <a href="tel:${contact.phone}" class="call-btn" onclick="initiateCall(${contact.id})">üìû</a>
            </div>
        `}).join('');
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function formatOutcome(outcome) {
        const labels = {
            'no-answer': 'No Answer',
            'call-back': 'Call Back',
            'qualified': 'Qualified',
            'unqualified': 'Unqualified'
        };
        return labels[outcome] || outcome;
    }

    function initiateCall(id) {
        currentCallId = id;
        const contact = contacts.find(c => c.id === id);
        if (contact) {
            outcomeContactName.textContent = contact.name;
        }
        // Show modal after a short delay to let the call initiate
        setTimeout(() => {
            outcomeModal.classList.add('active');
        }, 500);
    }

    function markCalled(id) {
        calledSet.add(id);
        const card = document.querySelector(`[data-id="${id}"]`);
        if (card) card.classList.add('called');
        updateStats();
    }

    function updateStats() {
        document.getElementById('totalCount').textContent = contacts.length;
        document.getElementById('calledCount').textContent = calledSet.size;
        document.getElementById('remainingCount').textContent = contacts.length - calledSet.size;
    }

    resetBtn.addEventListener('click', () => {
        if (confirm('Reset all called status?')) {
            calledSet.clear();
            renderContacts();
        }
    });

    // Search functionality
    searchFab.addEventListener('click', () => {
        searchOverlay.classList.add('active');
        searchInput.focus();
    });

    searchOverlay.addEventListener('click', (e) => {
        if (e.target === searchOverlay) {
            searchOverlay.classList.remove('active');
        }
    });

    searchInput.addEventListener('input', (e) => {
        searchTerm = e.target.value;
        clearSearch.classList.toggle('visible', searchTerm.length > 0);
        renderContacts();
    });

    clearSearch.addEventListener('click', () => {
        searchInput.value = '';
        searchTerm = '';
        clearSearch.classList.remove('visible');
        renderContacts();
        searchInput.focus();
    });

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && searchOverlay.classList.contains('active')) {
            searchOverlay.classList.remove('active');
        }
    });

    // Outcome modal functionality
    document.querySelectorAll('.outcome-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const outcome = btn.dataset.outcome;
            if (currentCallId !== null) {
                outcomes[currentCallId] = outcome;
                markCalled(currentCallId);
                renderContacts();
            }
            outcomeModal.classList.remove('active');
            currentCallId = null;
        });
    });

    // Close modal if tapping outside (optional - remove if you want to force selection)
    outcomeModal.addEventListener('click', (e) => {
        if (e.target === outcomeModal) {
            if (currentCallId !== null) {
                markCalled(currentCallId);
            }
            outcomeModal.classList.remove('active');
            currentCallId = null;
        }
    });
</script>
```

</body>
</html>
