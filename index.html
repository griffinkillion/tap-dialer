<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tap-to-Call Dialer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f7;
            min-height: 100vh;
        }
        h1 {
            font-size: 24px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 20px;
        }
        .upload-area {
            background: white;
            border: 2px dashed #d2d2d7;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 20px;
        }
        .upload-area:hover {
            border-color: #007aff;
            background: #f0f7ff;
        }
        .upload-area.dragover {
            border-color: #007aff;
            background: #e5f1ff;
        }
        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        .upload-text {
            color: #86868b;
            font-size: 16px;
        }
        input[type="file"] {
            display: none;
        }
        .column-selector {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            display: none;
        }
        .column-selector label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #1d1d1f;
        }
        .column-selector select {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            background: white;
            margin-bottom: 12px;
        }
        .stats {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            display: none;
        }
        .stats-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .stats-row:last-child {
            border-bottom: none;
        }
        .stats-label {
            color: #86868b;
        }
        .stats-value {
            font-weight: 600;
            color: #1d1d1f;
        }
        .contact-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .contact-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .contact-card.called {
            background: #f0fff0;
            opacity: 0.7;
        }
        .contact-info {
            flex: 1;
            min-width: 0;
        }
        .contact-name {
            font-weight: 600;
            color: #1d1d1f;
            font-size: 17px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .contact-number {
            color: #86868b;
            font-size: 15px;
            margin-top: 2px;
        }
        .call-btn {
            background: #34c759;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            flex-shrink: 0;
            margin-left: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: transform 0.1s;
        }
        .call-btn:active {
            transform: scale(0.95);
        }
        .called .call-btn {
            background: #86868b;
        }
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #86868b;
        }
        .reset-btn {
            width: 100%;
            padding: 16px;
            background: #ff3b30;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <h1>üìû Tap-to-Call Dialer</h1>

```
<div class="upload-area" id="uploadArea">
    <div class="upload-icon">üìÅ</div>
    <div class="upload-text">Tap to upload Excel or CSV file</div>
    <input type="file" id="fileInput" accept=".xlsx,.xls,.csv">
</div>

<div class="column-selector" id="columnSelector">
    <label for="nameColumn">Name Column (optional)</label>
    <select id="nameColumn">
        <option value="">-- None --</option>
    </select>
    
    <label for="phoneColumn">Phone Number Column</label>
    <select id="phoneColumn"></select>
</div>

<div class="stats" id="stats">
    <div class="stats-row">
        <span class="stats-label">Total contacts</span>
        <span class="stats-value" id="totalCount">0</span>
    </div>
    <div class="stats-row">
        <span class="stats-label">Called</span>
        <span class="stats-value" id="calledCount">0</span>
    </div>
    <div class="stats-row">
        <span class="stats-label">Remaining</span>
        <span class="stats-value" id="remainingCount">0</span>
    </div>
</div>

<div class="contact-list" id="contactList"></div>

<button class="reset-btn" id="resetBtn">Reset All</button>

<script>
    let contacts = [];
    let calledSet = new Set();
    let rawData = [];
    let headers = [];

    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const columnSelector = document.getElementById('columnSelector');
    const nameColumn = document.getElementById('nameColumn');
    const phoneColumn = document.getElementById('phoneColumn');
    const contactList = document.getElementById('contactList');
    const stats = document.getElementById('stats');
    const resetBtn = document.getElementById('resetBtn');

    // Upload area interactions
    uploadArea.addEventListener('click', () => fileInput.click());
    
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        if (e.dataTransfer.files.length) {
            handleFile(e.dataTransfer.files[0]);
        }
    });

    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length) {
            handleFile(e.target.files[0]);
        }
    });

    function handleFile(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const sheetName = workbook.SheetNames[0];
            const sheet = workbook.Sheets[sheetName];
            rawData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
            
            if (rawData.length > 0) {
                headers = rawData[0].map((h, i) => h || `Column ${i + 1}`);
                populateColumnSelectors();
                columnSelector.style.display = 'block';
            }
        };
        reader.readAsArrayBuffer(file);
    }

    function populateColumnSelectors() {
        nameColumn.innerHTML = '<option value="">-- None --</option>';
        phoneColumn.innerHTML = '';
        
        headers.forEach((header, index) => {
            const nameOpt = document.createElement('option');
            nameOpt.value = index;
            nameOpt.textContent = header;
            nameColumn.appendChild(nameOpt);
            
            const phoneOpt = document.createElement('option');
            phoneOpt.value = index;
            phoneOpt.textContent = header;
            phoneColumn.appendChild(phoneOpt);
        });

        // Auto-select likely phone column
        const phoneKeywords = ['phone', 'tel', 'mobile', 'cell', 'number', 'dial'];
        const nameKeywords = ['name', 'contact', 'person', 'customer', 'client'];
        
        headers.forEach((header, index) => {
            const lowerHeader = header.toString().toLowerCase();
            if (phoneKeywords.some(k => lowerHeader.includes(k))) {
                phoneColumn.value = index;
            }
            if (nameKeywords.some(k => lowerHeader.includes(k))) {
                nameColumn.value = index;
            }
        });

        nameColumn.addEventListener('change', loadContacts);
        phoneColumn.addEventListener('change', loadContacts);
        
        loadContacts();
    }

    function loadContacts() {
        const phoneIdx = parseInt(phoneColumn.value);
        const nameIdx = nameColumn.value ? parseInt(nameColumn.value) : null;
        
        contacts = [];
        
        for (let i = 1; i < rawData.length; i++) {
            const row = rawData[i];
            let phone = row[phoneIdx];
            
            if (phone) {
                phone = String(phone).replace(/[^\d+]/g, '');
                if (phone.length >= 7) {
                    contacts.push({
                        id: i,
                        name: nameIdx !== null ? (row[nameIdx] || `Contact ${i}`) : `Contact ${i}`,
                        phone: phone,
                        displayPhone: formatPhone(phone)
                    });
                }
            }
        }
        
        renderContacts();
    }

    function formatPhone(phone) {
        if (phone.length === 10) {
            return `(${phone.slice(0,3)}) ${phone.slice(3,6)}-${phone.slice(6)}`;
        } else if (phone.length === 11 && phone[0] === '1') {
            return `+1 (${phone.slice(1,4)}) ${phone.slice(4,7)}-${phone.slice(7)}`;
        }
        return phone;
    }

    function renderContacts() {
        if (contacts.length === 0) {
            contactList.innerHTML = '<div class="empty-state">No phone numbers found</div>';
            stats.style.display = 'none';
            resetBtn.style.display = 'none';
            return;
        }

        stats.style.display = 'block';
        resetBtn.style.display = 'block';
        updateStats();

        contactList.innerHTML = contacts.map(contact => `
            <div class="contact-card ${calledSet.has(contact.id) ? 'called' : ''}" data-id="${contact.id}">
                <div class="contact-info">
                    <div class="contact-name">${escapeHtml(contact.name)}</div>
                    <div class="contact-number">${contact.displayPhone}</div>
                </div>
                <a href="tel:${contact.phone}" class="call-btn" onclick="markCalled(${contact.id})">üìû</a>
            </div>
        `).join('');
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function markCalled(id) {
        calledSet.add(id);
        const card = document.querySelector(`[data-id="${id}"]`);
        if (card) card.classList.add('called');
        updateStats();
    }

    function updateStats() {
        document.getElementById('totalCount').textContent = contacts.length;
        document.getElementById('calledCount').textContent = calledSet.size;
        document.getElementById('remainingCount').textContent = contacts.length - calledSet.size;
    }

    resetBtn.addEventListener('click', () => {
        if (confirm('Reset all called status?')) {
            calledSet.clear();
            renderContacts();
        }
    });
</script>
```

</body>
</html>
